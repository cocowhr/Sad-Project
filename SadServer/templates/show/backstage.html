{% extends 'show/bkstg_layout.html' %}
{% load staticfiles %}

{% block headjs %}
    <script type="text/javascript">
        $(document).ready(function () {
            $('#homepage').addClass('active');
            $("#user_success").hide();
        });
    </script>
    <script type="text/javascript">
        function sendmsg(userid, credit) {
            $.post('{% url 'api.views.admituser' %}', {
                userid: (userid),
                credit: (credit),
            }, function (result) {
                if (result.success) {
                    submit_user()
                }
                if (result.fail) {
                    console.log(result);
                }
            });
        }
        function submit_user() {
            $("#user_success").fadeIn();
            setTimeout(function () {
                window.location = "{% url 'api.views.adminprelogin' %}";
            }, 1000);
        }
    </script>
{% endblock %}

{% block body %}
    <!-- register -->
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="row">
                    <div class="col-md-12">
                        <div class="page-header">
                            <h3>后台管理</h3>
                        </div>
                    </div>
                </div>


                <div class="row">
                    <div class="col-md-12">
                        <div class="alert alert-success text-center" role="alert" id="user_success">审核成功,3秒后刷新</div>
                        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">

                            <div class="panel panel-primary">
                                <div class="panel-heading" role="tab" id="headingPending">
                                    <h4 class="panel-title">
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#collapsePending" aria-expanded="true" aria-controls="collapsePending">
                                            待审核用户
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapsePending" class="panel-collapse collapse in" role="tabpanel"
                                     aria-labelledby="headingPending">
                                    <div class="panel-body">
                                        <table class="table">
                                            <thead>
                                            <tr>
                                                <th>用户名</th>
                                                <th>真实名字</th>
                                                <th>身份证号</th>
                                                <th>信用等级</th>
                                                <th colspan="3">#</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for user in userlist %}
                                                <tr id="{{ user.id }}">
                                                    <td>{{ user.name }}</td>
                                                    <td>{{ user.realname }}</td>
                                                    <td>{{ user.idcard }}</td>
                                                    <td>
                                                        <div class="col-md-6">
                                                            <input name="credit" class="form-control" type="text"
                                                                   id="credit" required>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <button class="btn btn-default btn-success" name="submit"
                                                                id="submit"
                                                                onclick="sendmsg('{{ user.id }}',document.getElementsByName('credit')[{{ user.tag }}].value)">
                                                            确认预约
                                                        </button>
                                                    </td>
                                                    <td>
                                                        <a href="{% url 'api.views.rejectuser' user.id %}">
                                                            <button class="btn btn-default btn-danger">拒绝
                                                            </button>
                                                        </a>
                                                    </td>

                                                </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>

    <!-- register -->

    {{ block.super }}
{% endblock %}